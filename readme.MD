# Backend Challenge Shipay

## Feito Por:
**Artur Valladares Hernandez Giacummo**

## VisÃ£o Geral

Este projeto tem como objetivo estruturar uma API REST em Python para resolver os exercÃ­cios 3, 4 e 5 propostos no desafio da Shipay.

## ğŸ§© Endpoints DisponÃ­veis

### Criar UsuÃ¡rio
**POST** `/user`  
Body (JSON):
```json
{
  "name": "string",
  "email": "string",
  "roleId": int,
  "password": "string (opcional)"
}
```
- Se a senha nÃ£o for fornecida, serÃ¡ gerada automaticamente.
- Retorna se conseguiu cirar o usuario ou nÃ£o

### Obter Role de um UsuÃ¡rio
**GET** `/user/{userId}/roles`  
- ForneÃ§a o ID do usuÃ¡rio na URL.
- Retorna todos os `role_id` do usuÃ¡rio correspondente.

---

## ğŸ—‚ï¸ Estrutura do Projeto

```
Desafio-Backend-Shipay/
â”‚
â”œâ”€â”€ Controller/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ UserController.py
â”‚
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ Base.py
â”‚   â”œâ”€â”€ Claim.py
â”‚   â”œâ”€â”€ RequestResponse.py
â”‚   â”œâ”€â”€ Role.py
â”‚   â”œâ”€â”€ User.py
â”‚   â””â”€â”€ UserClaim.py
â”‚
â”œâ”€â”€ Repository/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ DatabaseRepository.py
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ UserService.py
â”‚
â”œâ”€â”€ Utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ Logger.py
â”‚   â””â”€â”€ StartDataBase.py
â”‚
â”œâ”€â”€ main.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env
â””â”€â”€ README.md
```

---

## âš™ï¸ Como Rodar o Projeto

### 1. Configurar Banco de Dados PostgreSQL

1. Baixe o PostgreSQL: https://www.enterprisedb.com/downloads/postgres-postgresql-downloads  
2. Siga o instalador padrÃ£o e **anote sua senha e porta escolhidas**.
2.1 Na pagina "Setup - PostgresSQL", clique em "Next"
2.2 Na pagina "Installation Directory", escolha o que mais te agrade, ou mantenha o padrÃ£o, entÃ£o clique em "Next"
2.3 Na pagina "Select Components", nÃ£o mude nada e clique em Next"
2.5 Na pagina "Data Directory", scolha o que mais te agrade, ou mantenha o padrÃ£o, entÃ£o 
2.5 Na pagina "Password", digite a senha que gostaria para que seu usuario possa acessar o bannco. **IMPORTANTE: Guarde essa senha, pois vamos usalÃ¡ mais tarde**
2.6 Na pagina "Port", escolha a porta que gostaria que o Postgres usasse, ou mantenha a padrÃ£o (5432), entÃ£o clique em "Next" **IMPORTANTE: Guarde essa senha, pois vamos usalÃ¡ mais tarde**
2.7 Na pagina "Advanced Options" clique em "Next"
2.8 Na pagina "Pre Installation Summary" clique em ""Next"
2.9 Na pagina "Ready to Install" clique em "Next"
2.10 Aguarde a instalaÃ§Ã£o finalizar
2.11 Na pagina "Completing the PostgresSQL Setup Wizard", pode desmarcar o radio e entÃ£o clicar em "Finish"
3. VocÃª pode usar o banco `postgres` padrÃ£o ou criar um novo.

ğŸ“º *Dica*: [Veja esse vÃ­deo passo-a-passo](https://www.youtube.com/watch?v=4qH-7w5LZsA)

### 2. Configurar o Ambiente Python

1. Clone o projeto usando a linha de comando
```
git clone https://github.com/arturstaation/Desafio-Backend-Shipay.git
```

2. Crie um arquivo `.env` na raiz do projeto com o seguinte conteÃºdo:

```env
DATABASE_URL=postgresql://<usuario>:<senha>@<host>:<porta>/<database>
```

3. Substitua os campos conforme abaixo:

| Campo        | DescriÃ§Ã£o                                                                 |
|--------------|---------------------------------------------------------------------------|
| `<usuario>`  | Nome de usuÃ¡rio do seu banco de dados PostgreSQL.                         |
| `<senha>`    | Senha do usuÃ¡rio do banco.                                                |
| `<host>`     | EndereÃ§o do servidor (por exemplo: `localhost` ou um IP como `127.0.0.1`).|
| `<porta>`    | Porta do PostgreSQL (geralmente `5432`).                           |
| `<database>` | Nome do banco de dados que vocÃª criou (ex: `Teste`).                      |

Exemplo real:
```env
DATABASE_URL=postgresql://postgres:123@localhost:5432/Teste
```

4. Instale as dependÃªncias:
```bash
pip install -r requirements.txt
```

5. Execute a aplicaÃ§Ã£o:
```bash
python main.py
```

---

## ğŸ“Œ ObservaÃ§Ãµes

- As tabelas sÃ£o criadas automaticamente com base nos modelos definidos em `Models/`.
- Antes de realizar os testes, foi populada a tabela `roles` , ja que a tabela `users` usa uma chave estrangeira da tabela anterior. 
Exemplos:
```
INSERT INTO roles (id, description)
VALUES
  (1, 'Dono'),
  (2, 'Gerente'),
  (3, 'FuncionÃ¡rio');
```
---

## ğŸ§ª Testes

- Para testar, use o **Insomnia**, **Postman** ou qualquer ferramenta de requisiÃ§Ãµes HTTP.

1. Tentando criar usuario sem nome:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
	"email" : "testedono@empresa.com",
	"roleId" : "1"
}
```
Resultado:
![Resultado do Teste](testImages/teste1.png)
2. Tentando criar usuario sem nome, email:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
	"roleId" : "1"
}
```
![Resultado do Teste](testImages/teste2.png)
3. Tentando criar usuario sem nome, email,roleId:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
}
```
![Resultado do Teste](testImages/teste3.png)
4. Tentando criar usuario sem email,roleId:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Teste",
}
```
![Resultado do Teste](testImages/teste4.png)
5. Tentando criar usuario sem email:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Teste",
    "roleId": 1
}
```
![Resultado do Teste](testImages/teste5.png)
6. Tentando criar usuario sem roleId:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Teste",
    "email": "testedono@gmail.com"
}
```
![Resultado do Teste](testImages/teste6.png)
7. Tentando criar usuario com nome vazio:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "",
    "email": "testedono@gmail.com",
    "roleId": 1
}
```
![Resultado do Teste](testImages/teste7.png)
8. Tentando criar usuario com email invalido:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Joao",
    "email": "teste",
    "roleId": 1
}
```
![Resultado do Teste](testImages/teste8.png)
9. Tentando criar usuario com roleId sem ser um numero:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Joao",
    "email": "testedono@gmail.com",
    "roleId": "a"
}
```
![Resultado do Teste](testImages/teste9.png)
10. Tentando criar usuario com roleId inexistente:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Joao",
    "email": "testedono@gmail.com",
    "roleId": 10
}
```
![Resultado do Teste](testImages/teste10.png)
11. Criando usuario com sucesso:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Joao",
    "email": "testedono@gmail.com",
    "roleId": 1
}
```
![Resultado do Teste](testImages/teste11.png)
![Resultado do Teste](testImages/teste11_2.png)
12. Criando usuario com senha com sucesso:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/
Body:
```
{
    "name" : "Joao",
    "email": "testedono@gmail.com",
    "roleId": 1,
    "password" : "teste"
}
```
![Resultado do Teste](testImages/teste12.png)
![Resultado do Teste](testImages/teste12_2.png)

13. Obtendo roles de um usuario existente:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/1/getRoles
![Resultado do Teste](testImages/teste13.png)

14. Tentando obter roles de um userId invalido:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/aaaaa/getRoles
![Resultado do Teste](testImages/teste14.png)

15. Tentando obter roles de um userId inexistente:
RequisiÃ§Ã£o: http://127.0.0.1:5000/user/100/getRoles
![Resultado do Teste](testImages/teste15.png)
---
